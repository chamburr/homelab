---
apiVersion: ricoberger.de/v1alpha1
kind: VaultSecret
metadata:
  name: mailu-secret
  namespace: mail
spec:
  keys:
    - admin_email
    - admin_password
    - mail_domain
    - secret_key
  templates:
    admin_user: '{% regexReplaceAll "@.+" .Secrets.admin_email "" %}'
    admin_domain: '{% regexReplaceAll ".+@" .Secrets.admin_email "" %}'
    admin_password: "{% .Secrets.admin_password %}"
    mail_domain: "{% .Secrets.mail_domain %}"
    secret_key: "{% .Secrets.secret_key %}"
  path: secret/mail/mailu
  type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  name: mailu-certificates
  namespace: mail
  annotations:
    kustomize.toolkit.fluxcd.io/ssa: merge
    reflector.v1.k8s.emberstack.com/reflects: networking/certificate-tls
