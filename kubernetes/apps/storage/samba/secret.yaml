---
apiVersion: ricoberger.de/v1alpha1
kind: VaultSecret
metadata:
  name: samba-secret
  namespace: storage
spec:
  keys:
    - username
    - password
  templates:
    config.yml: |
      auth:
        - user: {% .Secrets.username %}
          group: {% .Secrets.username %}
          uid: 0
          gid: 0
          password: {% .Secrets.password %}
      global:
        - "force user = {% .Secrets.username %}"
        - "force group = {% .Secrets.username %}"
      share:
        - name: {% .Secrets.username %}
          path: /share/samba/{% .Secrets.username %}
          browsable: yes
          readonly: no
          guestok: no
          validusers: {% .Secrets.username %}
          writelist: {% .Secrets.username %}
          veto: no
  path: secret/storage/samba
  type: Opaque
