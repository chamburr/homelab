---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: gitea
  namespace: developer
spec:
  interval: 15m
  chart:
    spec:
      chart: gitea
      version: 6.0.2
      sourceRef:
        kind: HelmRepository
        name: gitea
        namespace: flux-system
  install:
    remediation:
      retries: 3
  upgrade:
    remediation:
      retries: 3
  values:
    gitea:
      admin:
        username: ""
        password: ""
      config:
        repository:
          DEFAULT_BRANCH: master
          DEFAULT_PRIVATE: public
        server:
          DOMAIN: git.${DOMAIN}
          ROOT_URL: https://git.${DOMAIN}
          DISABLE_SSH: true
          ENABLE_GZIP: true
          LFS_START_SERVER: true
        cache:
          ENABLED: true
          ADAPTER: memory
        database:
          DB_TYPE: sqlite3
        indexer:
          REPO_INDEXER_ENABLED: true
        service:
          DISABLE_REGISTRATION: true
        mailer:
          ENABLED: true
          MAILER_TYPE: smtp
          HOST: ${MAIL_HOST}:${MAIL_PORT}
          USER: ${MAIL_USERNAME}
          PASSWD: ${MAIL_PASSWORD}
          FROM: ${MAIL_SENDER}
        cron:
          ENABLED: true
    memcached:
      enabled: false
    postgresql:
      enabled: false
    persistence:
      enabled: true
      existingClaim: gitea-data
    ingress:
      enabled: true
      className: traefik
      hosts:
        - host: git.${DOMAIN}
          paths:
            - path: /
              pathType: Prefix
      tls:
        - hosts:
            - git.${DOMAIN}
