---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: sentry
  namespace: developer
spec:
  interval: 30m
  chart:
    spec:
      chart: sentry
      version: 14.1.2
      sourceRef:
        kind: HelmRepository
        name: sentry-charts
        namespace: flux-system
  values:
    system:
      url: https://sentry.${DOMAIN}
    auth:
      register: false
    mail:
      backend: smtp
      useTls: true
      host: ${MAIL_HOST}
      port: ${MAIL_PORT}
      username: ${MAIL_USERNAME}
      password: ${MAIL_PASSWORD}
      from: ${MAIL_SENDER}
    clickhouse:
      persistentVolumeClaim:
        enabled: true
        dataPersistentVolume:
          enabled: true
          existingClaim: sentry-clickhouse
    zookeeper:
      persistence:
        enabled: true
        existingClaim: sentry-zookeeper
    kafka:
      persistence:
        enabled: true
        existingClaim: sentry-kafka
    redis:
      master:
        persistence:
          enabled: true
          existingClaim: sentry-redis
    postgresql:
      persistence:
        enabled: true
        existingClaim: sentry-postgresql
    rabbitmq:
      persistence:
        enabled: true
        existingClaim: sentry-rabbitmq
    nginx:
      enabled: false
    filestore:
      filesystem:
        persistence:
          enabled: true
          persistentWorkers: true
          existingClaim: sentry-data
    ingress:
      enabled: true
      rehexPathStyle: traefik
      hostname: sentry.${DOMAIN}
      tls:
        - hosts:
            - sentry.${DOMAIN}
