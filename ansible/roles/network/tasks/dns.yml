---
- name: Install dnsmasq package
  ansible.builtin.dnf:
    name: dnsmasq
    state: present

- name: Configure dnsmasq
  ansible.builtin.lineinfile:
    path: /etc/dnsmasq.conf
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
    state: present
  loop:
    - regexp: ^#?port=
      line: port=5353
    - regexp: ^interface=lo
      line: "#interface=lo"
    - regexp: ^bind-interfaces
      line: "#bind-interfaces"
    - regexp: ^#?cache-size=
      line: cache-size=0
  notify: Restart dnsmasq service

- name: Enable dnsmasq service
  ansible.builtin.service:
    name: dnsmasq
    enabled: true
    state: started
